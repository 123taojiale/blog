(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["blog_detail"],{"0295":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"CatalogList-container"},t._l(t.list,(function(e,s){return a("li",{key:s},[a("span",{staticClass:"item",class:{active:e.isSelected},on:{click:function(a){return t.handleClick(e)}}},[t._v(" "+t._s(e.name)+" "),a("span",{staticClass:"aside"},[t._v(t._s(e.aside))])]),a("CatalogList",{attrs:{list:e.children},on:{selectChange:t.handleClick}})],1)})),0)},i=[],n={name:"CatalogList",props:{list:{type:Array,default:()=>[]}},methods:{handleClick(t){this.$emit("selectChange",t)}}},o=n,l=(a("1afc"),a("2877")),c=Object(l["a"])(o,s,i,!1,null,"2d85055e",null);e["a"]=c.exports},"1afc":function(t,e,a){"use strict";a("bdf9")},"3e10":function(t,e,a){"use strict";a("6ae2")},"5aa1":function(t,e,a){"use strict";a("73e3")},"5e74":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"Detail-container"},[a("BaseLayout",{scopedSlots:t._u([{key:"right",fn:function(){return[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"aside-toc-container"},[t.blogDetailInfo?a("BlogDetailTOC",{attrs:{toc:t.toc}}):t._e()],1)]},proxy:!0}])},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],ref:"scrollDOM",staticClass:"main-container"},[t.blogDetailInfo?a("BlogDetail",{attrs:{blog:t.blogDetailInfo}}):t._e(),t.blogDetailInfo?a("BlogComment"):t._e()],1)])],1)},i=[],n=a("0986"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"BlogDetail-container"},[a("div",{staticClass:"title"},[a("h1",[t._v(t._s(t.blog.title))])]),a("div",{staticClass:"aside"},[a("span",{staticClass:"item"},[t._v("日期："+t._s(t.formatDate(t.blog.createDate)))]),a("span",{staticClass:"item"},[t._v("浏览："+t._s(t.blog.scanNumber))]),a("a",{staticClass:"item",attrs:{href:"#MessageArea-container"}},[t._v("评论："+t._s(t.blog.commentNumber))]),a("RouterLink",{staticClass:"item",attrs:{to:{name:"BlogCategoryList",params:{category_id:t.blog.category.id}}}},[t._v(t._s(t.blog.category.name))])],1),a("div",{staticClass:"content markdown-body",domProps:{innerHTML:t._s(t.blog.htmlContent)}})])},l=[],c=a("c1df"),r=a.n(c),m={name:"BlogDetail",props:{blog:{type:Object}},methods:{formatDate(t){return r()(+t).format("YYYY-MM-DD")}}},d=m,h=(a("8fea"),a("2877")),u=Object(h["a"])(d,o,l,!1,null,"911557f6",null),g=u.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"BlogDetailTOC-container"},[a("h3",{staticClass:"toc"},[t._v("目录")]),a("CatalogList",{attrs:{list:t.tocWithSelected},on:{selectChange:t.handleSelectChange}})],1)},p=[],v=a("0295"),b={name:"BlogDetailTOC",props:{toc:{type:Array}},components:{CatalogList:v["a"]},data(){return{activeAnchor:"",catalogKey:0}},mounted(){this.$bus.$on("mainScroll",this.handleScroll),window.handleScroll=this.handleScroll},beforeDestroy(){this.$bus.$off("mainScroll",this.handleScroll)},computed:{tocWithSelected(){const t=e=>e.map(e=>{const a=e.children&&e.children.length;return a?{...e,isSelected:e.anchor===this.activeAnchor,children:t(e.children)}:{...e,isSelected:e.anchor===this.activeAnchor}});return t(this.toc)},tocDOMList(){const t=[],e=a=>{for(const s of a){const a=document.getElementById(s.anchor);t.push(a),s.children&&s.children.length&&e(s.children)}};return e(this.toc),t}},methods:{handleSelectChange(t){location.hash=t.anchor},handleScroll(){this.activeAnchor="";const t=200;for(const e of this.tocDOMList){const a=e.getBoundingClientRect().top;if(a<0)this.activeAnchor=e.id;else{if(a>=0&&a<=t)return void(this.activeAnchor=e.id);if(a>t)return}}}}},C=b,D=(a("b410"),Object(h["a"])(C,f,p,!1,null,"a8d64d1c",null)),_=D.exports,L=a("365c"),S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"BlogComment-container"},[a("MessageArea",{attrs:{title:t.title,subTitle:"("+t.total+")",list:t.list,isListLoading:t.isLoading},on:{submit:t.handleSubmit}})],1)},k=[],M=a("684a"),y={name:"BlogComment",components:{MessageArea:M["a"]},data(){return{title:"评论列表",list:[],total:0,isLoading:!0,searchData:{page:1,limit:10,blogid:""}}},computed:{hasMore(){return this.list.length<this.total}},created(){this.getComments(),window.fetchMoreComments=this.fetchMoreComments},mounted(){this.$bus.$on("mainScroll",this.handleScroll)},methods:{handleScroll(t){const e=200,a=t.scrollHeight,s=t.scrollTop,i=t.clientHeight,n=Math.abs(a-s-i);n<e&&this.fetchMoreComments()},fetchMoreComments(){!this.isLoading&&this.hasMore&&(this.searchData.page++,this.getComments())},async getComments(){this.isLoading=!0;const t=await L["a"].getComments(this.searchData);this.total=t.total,this.list=this.list.concat(t.rows),this.isLoading=!1},async postComment(t,e){console.log("点击了提交评论按钮",t);const a=await L["a"].postComment(t);a?(this.list.unshift(a),this.total++,e("success","评论成功")):e("error","评论失败")},handleSubmit(t,e){this.postComment(t,e)}}},x=y,w=(a("5aa1"),Object(h["a"])(x,S,k,!1,null,"29694323",null)),B=w.exports,$=a("1b62"),I=a("ed08"),A={name:"Detail",mixins:[$["a"].mainScroll("scrollDOM")],components:{BaseLayout:n["a"],BlogDetail:g,BlogDetailTOC:_,BlogComment:B},computed:{routerInfo(){return{id:this.$route.params.id}},toc(){return this.blogDetailInfo.toc}},data(){return{blogDetailInfo:null,isLoading:!0}},created(){this.getBlog()},mounted(){this.$refs.scrollDOM.onscroll=()=>console.log("scroll")},updated(){if(location.hash){const t=location.hash;location.hash="",setTimeout(()=>{location.hash=t},500)}},methods:{async getBlog(){this.isLoading=!0;let t=await L["a"].getBlog(this.routerInfo.id);t?(this.blogDetailInfo=t,I["a"].setRouterTitle(this.blogDetailInfo.title),this.isLoading=!1):this.$router.push("/404")}}},O=A,T=(a("bf11"),Object(h["a"])(O,s,i,!1,null,"eca35230",null));e["default"]=T.exports},"60c4":function(t,e,a){},"684a":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"MessageArea-container",attrs:{id:"MessageArea-container"}},[a("DataForm",t._g({},t.$listeners)),a("div",{staticClass:"title"},[a("h3",[t._v(" "+t._s(t.title)+" "),a("span",{staticClass:"sub"},[t._v(t._s(t.subTitle))])])]),a("DataList",{attrs:{list:t.list,isListLoading:t.isListLoading}})],1)},i=[],n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{ref:"commentForm",staticClass:"DataForm-container",on:{submit:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[a("div",{staticClass:"form-item"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.postData.nickname,expression:"postData.nickname"}],staticClass:"nickname",attrs:{type:"text",placeholder:"昵称",maxlength:t.nicknameMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.nickname},on:{input:function(e){e.target.composing||t.$set(t.postData,"nickname",e.target.value)}}}),a("span",{staticClass:"tip nickname",class:{maxLen:t.postData.nickname.length>=t.nicknameMaxLength}},[t._v(" "+t._s(t.postData.nickname.length+"/"+t.nicknameMaxLength)+" ")]),a("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.nickname))])]),a("div",{staticClass:"form-item"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.postData.content,expression:"postData.content"}],staticClass:"content",attrs:{placeholder:"内容",rows:"4",maxlength:t.contentMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.content},on:{input:function(e){e.target.composing||t.$set(t.postData,"content",e.target.value)}}}),t._v(" "),a("span",{staticClass:"tip",class:{maxLen:t.postData.content.length>=t.contentMaxLength}},[t._v(" "+t._s(t.postData.content.length+"/"+t.contentMaxLength)+" ")]),a("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.content))])]),a("div",{staticClass:"form-item"},[a("button",{staticClass:"submit",class:{submitting:t.isSubmitting},attrs:{disabled:t.isSubmitting}},[t._v(" "+t._s(t.isSubmitting?"提交中...":"提交")+" ")])])])},o=[],l={name:"DataForm",data(){return{postData:{nickname:"",content:""},nicknameMaxLength:10,contentMaxLength:300,errorInfo:{nickname:"",content:""},isSubmitting:!1}},methods:{handleSubmit(){this.beforeSubmit()&&(this.isSubmitting=!0,this.$emit("submit",this.postData,(t,e)=>{this.$showMessage({content:e,type:t,container:this.$refs.commentForm,duration:1500,callback:this.initForm})}))},beforeSubmit(){return""===this.postData.nickname&&(this.errorInfo.nickname="请填写昵称"),""===this.postData.content&&(this.errorInfo.content="请填写评论内容"),!this.errorInfo.nickname&&!this.errorInfo.content},initForm(){this.isSubmitting=!1,this.postData.nickname="",this.postData.content=""}},watch:{postData:{handler(){this.errorInfo.nickname="",this.errorInfo.content=""},deep:!0}}},c=l,r=(a("96ad"),a("2877")),m=Object(r["a"])(c,n,o,!1,null,"26861937",null),d=m.exports,h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"DataList-container"},[a("ul",{staticClass:"list-container"},t._l(t.list,(function(e){return a("li",{key:e.id,staticClass:"item"},[a("div",{staticClass:"left"},[a("BaseAvatar",{attrs:{src:e.avatar,size:50}})],1),a("div",{staticClass:"right"},[a("p",{staticClass:"nickname"},[t._v(t._s(e.nickname))]),a("p",{staticClass:"content"},[t._v(t._s(e.content))]),a("div",{staticClass:"aside-infos"},[a("span",{staticClass:"create-time"},[t._v(t._s(t.formatDate(e.createDate)))])])])])})),0),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isListLoading,expression:"isListLoading"}],staticClass:"loading"})])},u=[],g=a("8cb0"),f=a("c1df"),p=a.n(f),v={name:"DataList",components:{BaseAvatar:g["a"]},props:{list:{type:Array,default:()=>[]},isListLoading:{type:Boolean,default:!1}},methods:{formatDate(t){return p()(+t).format("YYYY-MM-DD HH:MM:SS")}},watch:{isListLoading(t){console.log("isListLoading changed => ",t)}}},b=v,C=(a("c6ef"),Object(r["a"])(b,h,u,!1,null,"51fbb90c",null)),D=C.exports,_={name:"MessageArea",props:{list:{type:Array,default:()=>[]},title:{required:!0,type:String},subTitle:{required:!0,type:String},isListLoading:{type:Boolean,default:!1}},components:{DataForm:d,DataList:D},methods:{}},L=_,S=(a("3e10"),Object(r["a"])(L,s,i,!1,null,"0d4e1c6b",null));e["a"]=S.exports},"6ae2":function(t,e,a){},"70e9":function(t,e,a){},"73e3":function(t,e,a){},"8fea":function(t,e,a){"use strict";a("ddc1")},"96ad":function(t,e,a){"use strict";a("a9fd")},a9fd:function(t,e,a){},ab5c:function(t,e,a){},b410:function(t,e,a){"use strict";a("60c4")},bdf9:function(t,e,a){},bf11:function(t,e,a){"use strict";a("70e9")},c6ef:function(t,e,a){"use strict";a("ab5c")},ddc1:function(t,e,a){}}]);