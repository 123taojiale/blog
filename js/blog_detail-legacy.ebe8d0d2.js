(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["blog_detail"],{"0295":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"CatalogList-container"},t._l(t.list,(function(e,a){return n("li",{key:a},[n("span",{staticClass:"item",class:{active:e.isSelected},on:{click:function(n){return t.handleClick(e)}}},[t._v(" "+t._s(e.name)+" "),n("span",{staticClass:"aside"},[t._v(t._s(e.aside))])]),n("CatalogList",{attrs:{list:e.children},on:{selectChange:t.handleClick}})],1)})),0)},i=[],s={name:"CatalogList",props:{list:{type:Array,default:function(){return[]}}},methods:{handleClick:function(t){this.$emit("selectChange",t)}}},o=s,r=(n("1afc"),n("2877")),c=Object(r["a"])(o,a,i,!1,null,"2d85055e",null);e["a"]=c.exports},"18a5":function(t,e,n){"use strict";var a=n("23e7"),i=n("857a"),s=n("af03");a({target:"String",proto:!0,forced:s("anchor")},{anchor:function(t){return i(this,"a","name",t)}})},"1afc":function(t,e,n){"use strict";n("bdf9")},"3e10":function(t,e,n){"use strict";n("6ae2")},"5aa1":function(t,e,n){"use strict";n("73e3")},"5e74":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Detail-container"},[n("BaseLayout",{scopedSlots:t._u([{key:"right",fn:function(){return[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"aside-toc-container"},[t.blogDetailInfo?n("BlogDetailTOC",{attrs:{toc:t.toc}}):t._e()],1)]},proxy:!0}])},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],ref:"scrollDOM",staticClass:"main-container"},[t.blogDetailInfo?n("BlogDetail",{attrs:{blog:t.blogDetailInfo}}):t._e(),t.blogDetailInfo?n("BlogComment"):t._e()],1)])],1)},i=[],s=n("1da1"),o=(n("96cf"),n("0986")),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"BlogDetail-container"},[n("div",{staticClass:"title"},[n("h1",[t._v(t._s(t.blog.title))])]),n("div",{staticClass:"aside"},[n("span",{staticClass:"item"},[t._v("日期："+t._s(t.formatDate(t.blog.createDate)))]),n("span",{staticClass:"item"},[t._v("浏览："+t._s(t.blog.scanNumber))]),n("a",{staticClass:"item",attrs:{href:"#MessageArea-container"}},[t._v("评论："+t._s(t.blog.commentNumber))]),n("RouterLink",{staticClass:"item",attrs:{to:{name:"BlogCategoryList",params:{category_id:t.blog.category.id}}}},[t._v(t._s(t.blog.category.name))])],1),n("div",{staticClass:"content markdown-body",domProps:{innerHTML:t._s(t.blog.htmlContent)}})])},c=[],l=n("c1df"),u=n.n(l),m={name:"BlogDetail",props:{blog:{type:Object}},methods:{formatDate:function(t){return u()(+t).format("YYYY-MM-DD")}}},d=m,f=(n("8fea"),n("2877")),h=Object(f["a"])(d,r,c,!1,null,"911557f6",null),g=h.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"BlogDetailTOC-container"},[n("h3",{staticClass:"toc"},[t._v("目录")]),n("CatalogList",{attrs:{list:t.tocWithSelected},on:{selectChange:t.handleSelectChange}})],1)},v=[],b=n("b85c"),C=n("5530"),D=(n("d81d"),n("18a5"),n("0295")),_={name:"BlogDetailTOC",props:{toc:{type:Array}},components:{CatalogList:D["a"]},data:function(){return{activeAnchor:"",catalogKey:0}},mounted:function(){this.$bus.$on("mainScroll",this.handleScroll),window.handleScroll=this.handleScroll},beforeDestroy:function(){this.$bus.$off("mainScroll",this.handleScroll)},computed:{tocWithSelected:function(){var t=this,e=function e(n){return n.map((function(n){var a=n.children&&n.children.length;return a?Object(C["a"])(Object(C["a"])({},n),{},{isSelected:n.anchor===t.activeAnchor,children:e(n.children)}):Object(C["a"])(Object(C["a"])({},n),{},{isSelected:n.anchor===t.activeAnchor})}))};return e(this.toc)},tocDOMList:function(){var t=[],e=function e(n){var a,i=Object(b["a"])(n);try{for(i.s();!(a=i.n()).done;){var s=a.value,o=document.getElementById(s.anchor);t.push(o),s.children&&s.children.length&&e(s.children)}}catch(r){i.e(r)}finally{i.f()}};return e(this.toc),t}},methods:{handleSelectChange:function(t){location.hash=t.anchor},handleScroll:function(){this.activeAnchor="";var t,e=200,n=Object(b["a"])(this.tocDOMList);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.getBoundingClientRect().top;if(i<0)this.activeAnchor=a.id;else{if(i>=0&&i<=e)return void(this.activeAnchor=a.id);if(i>e)return}}}catch(s){n.e(s)}finally{n.f()}}}},L=_,k=(n("b410"),Object(f["a"])(L,p,v,!1,null,"a8d64d1c",null)),x=k.exports,S=n("365c"),y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"BlogComment-container"},[n("MessageArea",{attrs:{title:t.title,subTitle:"("+t.total+")",list:t.list,isListLoading:t.isLoading},on:{submit:t.handleSubmit}})],1)},M=[],w=(n("99af"),n("684a")),O={name:"BlogComment",components:{MessageArea:w["a"]},data:function(){return{title:"评论列表",list:[],total:0,isLoading:!0,searchData:{page:1,limit:10,blogid:""}}},computed:{hasMore:function(){return this.list.length<this.total}},created:function(){this.getComments(),window.fetchMoreComments=this.fetchMoreComments},mounted:function(){this.$bus.$on("mainScroll",this.handleScroll)},methods:{handleScroll:function(t){var e=200,n=t.scrollHeight,a=t.scrollTop,i=t.clientHeight,s=Math.abs(n-a-i);s<e&&this.fetchMoreComments()},fetchMoreComments:function(){!this.isLoading&&this.hasMore&&(this.searchData.page++,this.getComments())},getComments:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,S["a"].getComments(t.searchData);case 3:n=e.sent,t.total=n.total,t.list=t.list.concat(n.rows),t.isLoading=!1;case 7:case"end":return e.stop()}}),e)})))()},postComment:function(t,e){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("点击了提交评论按钮",t),a.next=3,S["a"].postComment(t);case 3:i=a.sent,i?(n.list.unshift(i),n.total++,e("success","评论成功")):e("error","评论失败");case 5:case"end":return a.stop()}}),a)})))()},handleSubmit:function(t,e){this.postComment(t,e)}}},B=O,$=(n("5aa1"),Object(f["a"])(B,y,M,!1,null,"29694323",null)),I=$.exports,A=n("1b62"),j=n("ed08"),T={name:"Detail",mixins:[A["a"].mainScroll("scrollDOM")],components:{BaseLayout:o["a"],BlogDetail:g,BlogDetailTOC:x,BlogComment:I},computed:{routerInfo:function(){return{id:this.$route.params.id}},toc:function(){return this.blogDetailInfo.toc}},data:function(){return{blogDetailInfo:null,isLoading:!0}},created:function(){this.getBlog()},mounted:function(){this.$refs.scrollDOM.onscroll=function(){return console.log("scroll")}},updated:function(){if(location.hash){var t=location.hash;location.hash="",setTimeout((function(){location.hash=t}),500)}},methods:{getBlog:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,S["a"].getBlog(t.routerInfo.id);case 3:if(n=e.sent,n){e.next=7;break}return t.$router.push("/404"),e.abrupt("return");case 7:t.blogDetailInfo=n,j["a"].setRouterTitle(t.blogDetailInfo.title),t.isLoading=!1;case 10:case"end":return e.stop()}}),e)})))()}}},E=T,R=(n("bf11"),Object(f["a"])(E,a,i,!1,null,"eca35230",null));e["default"]=R.exports},"60c4":function(t,e,n){},"684a":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"MessageArea-container",attrs:{id:"MessageArea-container"}},[n("DataForm",t._g({},t.$listeners)),n("div",{staticClass:"title"},[n("h3",[t._v(" "+t._s(t.title)+" "),n("span",{staticClass:"sub"},[t._v(t._s(t.subTitle))])])]),n("DataList",{attrs:{list:t.list,isListLoading:t.isListLoading}})],1)},i=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{ref:"commentForm",staticClass:"DataForm-container",on:{submit:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[n("div",{staticClass:"form-item"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.postData.nickname,expression:"postData.nickname"}],staticClass:"nickname",attrs:{type:"text",placeholder:"昵称",maxlength:t.nicknameMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.nickname},on:{input:function(e){e.target.composing||t.$set(t.postData,"nickname",e.target.value)}}}),n("span",{staticClass:"tip nickname",class:{maxLen:t.postData.nickname.length>=t.nicknameMaxLength}},[t._v(" "+t._s(t.postData.nickname.length+"/"+t.nicknameMaxLength)+" ")]),n("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.nickname))])]),n("div",{staticClass:"form-item"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.postData.content,expression:"postData.content"}],staticClass:"content",attrs:{placeholder:"内容",rows:"4",maxlength:t.contentMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.content},on:{input:function(e){e.target.composing||t.$set(t.postData,"content",e.target.value)}}}),t._v(" "),n("span",{staticClass:"tip",class:{maxLen:t.postData.content.length>=t.contentMaxLength}},[t._v(" "+t._s(t.postData.content.length+"/"+t.contentMaxLength)+" ")]),n("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.content))])]),n("div",{staticClass:"form-item"},[n("button",{staticClass:"submit",class:{submitting:t.isSubmitting},attrs:{disabled:t.isSubmitting}},[t._v(" "+t._s(t.isSubmitting?"提交中...":"提交")+" ")])])])},o=[],r={name:"DataForm",data:function(){return{postData:{nickname:"",content:""},nicknameMaxLength:10,contentMaxLength:300,errorInfo:{nickname:"",content:""},isSubmitting:!1}},methods:{handleSubmit:function(){var t=this;this.beforeSubmit()&&(this.isSubmitting=!0,this.$emit("submit",this.postData,(function(e,n){t.$showMessage({content:n,type:e,container:t.$refs.commentForm,duration:1500,callback:t.initForm})})))},beforeSubmit:function(){return""===this.postData.nickname&&(this.errorInfo.nickname="请填写昵称"),""===this.postData.content&&(this.errorInfo.content="请填写评论内容"),!this.errorInfo.nickname&&!this.errorInfo.content},initForm:function(){this.isSubmitting=!1,this.postData.nickname="",this.postData.content=""}},watch:{postData:{handler:function(){this.errorInfo.nickname="",this.errorInfo.content=""},deep:!0}}},c=r,l=(n("96ad"),n("2877")),u=Object(l["a"])(c,s,o,!1,null,"26861937",null),m=u.exports,d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"DataList-container"},[n("ul",{staticClass:"list-container"},t._l(t.list,(function(e){return n("li",{key:e.id,staticClass:"item"},[n("div",{staticClass:"left"},[n("BaseAvatar",{attrs:{src:e.avatar,size:50}})],1),n("div",{staticClass:"right"},[n("p",{staticClass:"nickname"},[t._v(t._s(e.nickname))]),n("p",{staticClass:"content"},[t._v(t._s(e.content))]),n("div",{staticClass:"aside-infos"},[n("span",{staticClass:"create-time"},[t._v(t._s(t.formatDate(e.createDate)))])])])])})),0),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isListLoading,expression:"isListLoading"}],staticClass:"loading"})])},f=[],h=n("8cb0"),g=n("c1df"),p=n.n(g),v={name:"DataList",components:{BaseAvatar:h["a"]},props:{list:{type:Array,default:function(){return[]}},isListLoading:{type:Boolean,default:!1}},methods:{formatDate:function(t){return p()(+t).format("YYYY-MM-DD HH:MM:SS")}},watch:{isListLoading:function(t){console.log("isListLoading changed => ",t)}}},b=v,C=(n("c6ef"),Object(l["a"])(b,d,f,!1,null,"51fbb90c",null)),D=C.exports,_={name:"MessageArea",props:{list:{type:Array,default:function(){return[]}},title:{required:!0,type:String},subTitle:{required:!0,type:String},isListLoading:{type:Boolean,default:!1}},components:{DataForm:m,DataList:D},methods:{}},L=_,k=(n("3e10"),Object(l["a"])(L,a,i,!1,null,"0d4e1c6b",null));e["a"]=k.exports},"6ae2":function(t,e,n){},"70e9":function(t,e,n){},"73e3":function(t,e,n){},"857a":function(t,e,n){var a=n("e330"),i=n("1d80"),s=n("577e"),o=/"/g,r=a("".replace);t.exports=function(t,e,n,a){var c=s(i(t)),l="<"+e;return""!==n&&(l+=" "+n+'="'+r(s(a),o,"&quot;")+'"'),l+">"+c+"</"+e+">"}},"8fea":function(t,e,n){"use strict";n("ddc1")},"96ad":function(t,e,n){"use strict";n("a9fd")},a9fd:function(t,e,n){},ab5c:function(t,e,n){},af03:function(t,e,n){var a=n("d039");t.exports=function(t){return a((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},b410:function(t,e,n){"use strict";n("60c4")},bdf9:function(t,e,n){},bf11:function(t,e,n){"use strict";n("70e9")},c6ef:function(t,e,n){"use strict";n("ab5c")},d81d:function(t,e,n){"use strict";var a=n("23e7"),i=n("b727").map,s=n("1dde"),o=s("map");a({target:"Array",proto:!0,forced:!o},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},ddc1:function(t,e,n){}}]);