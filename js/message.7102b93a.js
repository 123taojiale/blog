(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["message"],{"0d69":function(t,a,s){},"3e10":function(t,a,s){"use strict";s("6ae2")},"4d11":function(t,a,s){"use strict";s.r(a);var e=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{ref:"scrollDOM",staticClass:"TheMessage-container"},[s("MessageArea",{attrs:{title:"留言板",subTitle:"("+t.data.length+")",list:t.data,isListLoading:t.isLoading},on:{submit:t.postMessage}})],1)},n=[],i=s("684a"),o=s("365c"),r=s("1b62"),c={name:"TheMessage",components:{MessageArea:i["a"]},data(){return{data:[],isLoading:!1,searchData:{page:1,limit:10},totalCount:0,isListLoading:!1}},computed:{hasMore(){return this.data.length<this.totalCount}},mixins:[r["a"].mainScroll("scrollDOM")],created(){this.getMessage()},mounted(){this.$bus.$on("mainScroll",this.handleScroll)},unmounted(){this.$bus.$off("mainScroll",this.handleScroll)},methods:{async getMessage(){this.isLoading=!0;const t=await o["a"].getMessage(this.searchData);this.totalCount=t.total,this.data=this.data.concat(t.rows),this.isLoading=!1},async postMessage(t,a){const s=await o["a"].postMessage(t);s?(a("success","提交成功"),this.data.unshift(s),this.totalCount++):a("error","提交失败")},handleScroll(t){const a=200,s=t.scrollHeight,e=t.scrollTop,n=t.clientHeight,i=Math.abs(s-e-n);i<a&&this.fetchMore()},fetchMore(){!this.isLoading&&this.hasMore&&(this.searchData.page++,this.getMessage())}}},l=c,m=(s("7084"),s("2877")),u=Object(m["a"])(l,e,n,!1,null,"229691b4",null);a["default"]=u.exports},"684a":function(t,a,s){"use strict";var e=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"MessageArea-container",attrs:{id:"MessageArea-container"}},[s("DataForm",t._g({},t.$listeners)),s("div",{staticClass:"title"},[s("h3",[t._v(" "+t._s(t.title)+" "),s("span",{staticClass:"sub"},[t._v(t._s(t.subTitle))])])]),s("DataList",{attrs:{list:t.list,isListLoading:t.isListLoading}})],1)},n=[],i=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("form",{ref:"commentForm",staticClass:"DataForm-container",on:{submit:function(a){return a.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[s("div",{staticClass:"form-item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.postData.nickname,expression:"postData.nickname"}],staticClass:"nickname",attrs:{type:"text",placeholder:"昵称",maxlength:t.nicknameMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.nickname},on:{input:function(a){a.target.composing||t.$set(t.postData,"nickname",a.target.value)}}}),s("span",{staticClass:"tip nickname",class:{maxLen:t.postData.nickname.length>=t.nicknameMaxLength}},[t._v(" "+t._s(t.postData.nickname.length+"/"+t.nicknameMaxLength)+" ")]),s("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.nickname))])]),s("div",{staticClass:"form-item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.postData.content,expression:"postData.content"}],staticClass:"content",attrs:{placeholder:"内容",rows:"4",maxlength:t.contentMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.content},on:{input:function(a){a.target.composing||t.$set(t.postData,"content",a.target.value)}}}),t._v(" "),s("span",{staticClass:"tip",class:{maxLen:t.postData.content.length>=t.contentMaxLength}},[t._v(" "+t._s(t.postData.content.length+"/"+t.contentMaxLength)+" ")]),s("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.content))])]),s("div",{staticClass:"form-item"},[s("button",{staticClass:"submit",class:{submitting:t.isSubmitting},attrs:{disabled:t.isSubmitting}},[t._v(" "+t._s(t.isSubmitting?"提交中...":"提交")+" ")])])])},o=[],r={name:"DataForm",data(){return{postData:{nickname:"",content:""},nicknameMaxLength:10,contentMaxLength:300,errorInfo:{nickname:"",content:""},isSubmitting:!1}},methods:{handleSubmit(){this.beforeSubmit()&&(this.isSubmitting=!0,this.$emit("submit",this.postData,(t,a)=>{this.$showMessage({content:a,type:t,container:this.$refs.commentForm,duration:1500,callback:this.initForm})}))},beforeSubmit(){return""===this.postData.nickname&&(this.errorInfo.nickname="请填写昵称"),""===this.postData.content&&(this.errorInfo.content="请填写评论内容"),!this.errorInfo.nickname&&!this.errorInfo.content},initForm(){this.isSubmitting=!1,this.postData.nickname="",this.postData.content=""}},watch:{postData:{handler(){this.errorInfo.nickname="",this.errorInfo.content=""},deep:!0}}},c=r,l=(s("96ad"),s("2877")),m=Object(l["a"])(c,i,o,!1,null,"26861937",null),u=m.exports,d=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"DataList-container"},[s("ul",{staticClass:"list-container"},t._l(t.list,(function(a){return s("li",{key:a.id,staticClass:"item"},[s("div",{staticClass:"left"},[s("BaseAvatar",{attrs:{src:a.avatar,size:50}})],1),s("div",{staticClass:"right"},[s("p",{staticClass:"nickname"},[t._v(t._s(a.nickname))]),s("p",{staticClass:"content"},[t._v(t._s(a.content))]),s("div",{staticClass:"aside-infos"},[s("span",{staticClass:"create-time"},[t._v(t._s(t.formatDate(a.createDate)))])])])])})),0),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isListLoading,expression:"isListLoading"}],staticClass:"loading"})])},h=[],g=s("8cb0"),p=s("c1df"),f=s.n(p),v={name:"DataList",components:{BaseAvatar:g["a"]},props:{list:{type:Array,default:()=>[]},isListLoading:{type:Boolean,default:!1}},methods:{formatDate(t){return f()(+t).format("YYYY-MM-DD HH:MM:SS")}},watch:{isListLoading(t){console.log("isListLoading changed => ",t)}}},b=v,L=(s("c6ef"),Object(l["a"])(b,d,h,!1,null,"51fbb90c",null)),D=L.exports,M={name:"MessageArea",props:{list:{type:Array,default:()=>[]},title:{required:!0,type:String},subTitle:{required:!0,type:String},isListLoading:{type:Boolean,default:!1}},components:{DataForm:u,DataList:D},methods:{}},_=M,C=(s("3e10"),Object(l["a"])(_,e,n,!1,null,"0d4e1c6b",null));a["a"]=C.exports},"6ae2":function(t,a,s){},7084:function(t,a,s){"use strict";s("0d69")},"96ad":function(t,a,s){"use strict";s("a9fd")},a9fd:function(t,a,s){},ab5c:function(t,a,s){},c6ef:function(t,a,s){"use strict";s("ab5c")}}]);