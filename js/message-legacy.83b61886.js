(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["message"],{"0d69":function(t,a,e){},"3e10":function(t,a,e){"use strict";e("6ae2")},"4d11":function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{ref:"scrollDOM",staticClass:"TheMessage-container"},[e("MessageArea",{attrs:{title:"留言板",subTitle:"("+t.data.length+")",list:t.data,isListLoading:t.isLoading},on:{submit:t.postMessage}})],1)},s=[],i=e("1da1"),o=(e("96cf"),e("99af"),e("684a")),r=e("365c"),c=e("1b62"),l={name:"TheMessage",components:{MessageArea:o["a"]},data:function(){return{data:[],isLoading:!1,searchData:{page:1,limit:10},totalCount:0,isListLoading:!1}},computed:{hasMore:function(){return this.data.length<this.totalCount}},mixins:[c["a"].mainScroll("scrollDOM")],created:function(){this.getMessage()},mounted:function(){this.$bus.$on("mainScroll",this.handleScroll)},unmounted:function(){this.$bus.$off("mainScroll",this.handleScroll)},methods:{getMessage:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var e;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isLoading=!0,a.next=3,r["a"].getMessage(t.searchData);case 3:e=a.sent,t.totalCount=e.total,t.data=t.data.concat(e.rows),t.isLoading=!1;case 7:case"end":return a.stop()}}),a)})))()},postMessage:function(t,a){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r["a"].postMessage(t);case 2:s=n.sent,s?(a("success","提交成功"),e.data.unshift(s),e.totalCount++):a("error","提交失败");case 4:case"end":return n.stop()}}),n)})))()},handleScroll:function(t){var a=200,e=t.scrollHeight,n=t.scrollTop,s=t.clientHeight,i=Math.abs(e-n-s);i<a&&this.fetchMore()},fetchMore:function(){!this.isLoading&&this.hasMore&&(this.searchData.page++,this.getMessage())}}},u=l,m=(e("7084"),e("2877")),d=Object(m["a"])(u,n,s,!1,null,"229691b4",null);a["default"]=d.exports},"684a":function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"MessageArea-container",attrs:{id:"MessageArea-container"}},[e("DataForm",t._g({},t.$listeners)),e("div",{staticClass:"title"},[e("h3",[t._v(" "+t._s(t.title)+" "),e("span",{staticClass:"sub"},[t._v(t._s(t.subTitle))])])]),e("DataList",{attrs:{list:t.list,isListLoading:t.isListLoading}})],1)},s=[],i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("form",{ref:"commentForm",staticClass:"DataForm-container",on:{submit:function(a){return a.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.postData.nickname,expression:"postData.nickname"}],staticClass:"nickname",attrs:{type:"text",placeholder:"昵称",maxlength:t.nicknameMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.nickname},on:{input:function(a){a.target.composing||t.$set(t.postData,"nickname",a.target.value)}}}),e("span",{staticClass:"tip nickname",class:{maxLen:t.postData.nickname.length>=t.nicknameMaxLength}},[t._v(" "+t._s(t.postData.nickname.length+"/"+t.nicknameMaxLength)+" ")]),e("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.nickname))])]),e("div",{staticClass:"form-item"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.postData.content,expression:"postData.content"}],staticClass:"content",attrs:{placeholder:"内容",rows:"4",maxlength:t.contentMaxLength,disabled:t.isSubmitting},domProps:{value:t.postData.content},on:{input:function(a){a.target.composing||t.$set(t.postData,"content",a.target.value)}}}),t._v(" "),e("span",{staticClass:"tip",class:{maxLen:t.postData.content.length>=t.contentMaxLength}},[t._v(" "+t._s(t.postData.content.length+"/"+t.contentMaxLength)+" ")]),e("div",{staticClass:"error"},[t._v(t._s(t.errorInfo.content))])]),e("div",{staticClass:"form-item"},[e("button",{staticClass:"submit",class:{submitting:t.isSubmitting},attrs:{disabled:t.isSubmitting}},[t._v(" "+t._s(t.isSubmitting?"提交中...":"提交")+" ")])])])},o=[],r={name:"DataForm",data:function(){return{postData:{nickname:"",content:""},nicknameMaxLength:10,contentMaxLength:300,errorInfo:{nickname:"",content:""},isSubmitting:!1}},methods:{handleSubmit:function(){var t=this;this.beforeSubmit()&&(this.isSubmitting=!0,this.$emit("submit",this.postData,(function(a,e){t.$showMessage({content:e,type:a,container:t.$refs.commentForm,duration:1500,callback:t.initForm})})))},beforeSubmit:function(){return""===this.postData.nickname&&(this.errorInfo.nickname="请填写昵称"),""===this.postData.content&&(this.errorInfo.content="请填写评论内容"),!this.errorInfo.nickname&&!this.errorInfo.content},initForm:function(){this.isSubmitting=!1,this.postData.nickname="",this.postData.content=""}},watch:{postData:{handler:function(){this.errorInfo.nickname="",this.errorInfo.content=""},deep:!0}}},c=r,l=(e("96ad"),e("2877")),u=Object(l["a"])(c,i,o,!1,null,"26861937",null),m=u.exports,d=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"DataList-container"},[e("ul",{staticClass:"list-container"},t._l(t.list,(function(a){return e("li",{key:a.id,staticClass:"item"},[e("div",{staticClass:"left"},[e("BaseAvatar",{attrs:{src:a.avatar,size:50}})],1),e("div",{staticClass:"right"},[e("p",{staticClass:"nickname"},[t._v(t._s(a.nickname))]),e("p",{staticClass:"content"},[t._v(t._s(a.content))]),e("div",{staticClass:"aside-infos"},[e("span",{staticClass:"create-time"},[t._v(t._s(t.formatDate(a.createDate)))])])])])})),0),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isListLoading,expression:"isListLoading"}],staticClass:"loading"})])},f=[],h=e("8cb0"),g=e("c1df"),p=e.n(g),v={name:"DataList",components:{BaseAvatar:h["a"]},props:{list:{type:Array,default:function(){return[]}},isListLoading:{type:Boolean,default:!1}},methods:{formatDate:function(t){return p()(+t).format("YYYY-MM-DD HH:MM:SS")}},watch:{isListLoading:function(t){console.log("isListLoading changed => ",t)}}},b=v,L=(e("c6ef"),Object(l["a"])(b,d,f,!1,null,"51fbb90c",null)),D=L.exports,M={name:"MessageArea",props:{list:{type:Array,default:function(){return[]}},title:{required:!0,type:String},subTitle:{required:!0,type:String},isListLoading:{type:Boolean,default:!1}},components:{DataForm:m,DataList:D},methods:{}},_=M,C=(e("3e10"),Object(l["a"])(_,n,s,!1,null,"0d4e1c6b",null));a["a"]=C.exports},"6ae2":function(t,a,e){},7084:function(t,a,e){"use strict";e("0d69")},"96ad":function(t,a,e){"use strict";e("a9fd")},a9fd:function(t,a,e){},ab5c:function(t,a,e){},c6ef:function(t,a,e){"use strict";e("ab5c")}}]);